# Mindflow 项目完整规划文档

**版本**: v1.0
**发布日期**: 2024-12-03
**项目名称**: Mindflow（心流） - 个人AI助理系统
**项目阶段**: 规划和初始开发准备

---

## 📋 目录

1. [项目概述](#项目概述)
2. [核心设计理念](#核心设计理念)
3. [系统架构设计](#系统架构设计)
4. [技术栈选择](#技术栈选择)
5. [核心功能设计](#核心功能设计)
6. [数据库设计](#数据库设计)
7. [用户体验设计](#用户体验设计)
8. [9阶段规划](#9阶段规划)
9. [6个开发Phase](#6个开发phase)
10. [风险和假设](#风险和假设)

---

## 项目概述

### 问题陈述
现代人的工作和生活中面临以下挑战：
- **信息碎片化**：每天经历许多事件，但很难系统地记录和整理
- **目标模糊化**：制定了计划却难以持续推动
- **反思不足**：缺乏定期的深度反思机制
- **个性化程度低**：通用的建议往往不符合个人特征

### 解决方案
构建一个**个性化AI助理系统**，帮助用户：
1. **记录**：通过自然对话记录日常事件
2. **规划**：制定和追踪目标
3. **反思**：进行个性化的每日复盘
4. **学习**：系统逐步了解用户，提供定制化帮助

### 核心价值主张
- **隐私优先**：所有数据本地存储，用户完全控制
- **个性化**：不是固定的流程，而是学习用户特征的动态系统
- **简洁高效**：专注核心功能，避免过度设计
- **可扩展**：为知识库、多用户等未来功能预留架构

### MVP 范围

**包含的核心功能：**
- ✅ 生活记录系统（对话式事件记录）
- ✅ 计划管理系统（目标设定和进度跟踪）
- ✅ 每日复盘系统（个性化反思提示）
- ✅ 用户画像系统（特征学习和个性化调整）
- ✅ 灵活的LLM配置（支持快速切换）

**后续扩展功能（v2.0+）：**
- ⏳ 知识库管理和向量检索
- ⏳ 多种通知方式（邮件、推送等）
- ⏳ 外部应用集成（Notion、Evernote等）
- ⏳ 高级分析和推荐系统
- ⏳ 多用户支持

---

## 核心设计理念

### 1. 隐私优先（Privacy First）
- **数据所有权**：所有用户数据完全由用户拥有和控制
- **本地存储**：采用自建服务器部署，数据不经过第三方
- **可选本地LLM**：支持Ollama等本地LLM，避免敏感数据上传
- **明确的数据政策**：清晰说明数据的存储和使用方式

### 2. 个性化（Personalization）
系统的核心竞争力不是单个功能，而是**逐步了解用户**的能力：

**三层学习机制：**
1. **初始档案层**：首次使用时的问卷（快速获得基础信息）
2. **对话学习层**：从日常交互中分析用户的工作方式和思维模式
3. **复盘学习层**：通过用户的反思内容理解改进方向和价值观

**个性化应用：**
- 复盘提示会根据用户画像动态调整
- 计划推动的方式会适应用户的行动风格
- 系统的建议会基于用户的历史和特征

### 3. 模块化（Modularity）
- **清晰的模块划分**：各功能相对独立，便于开发、测试、维护
- **解耦的LLM层**：业务逻辑与LLM选择完全分离
- **可插拔的Agent**：每个Agent独立设计，可单独迭代
- **数据库设计**：预留user_id字段，为多用户支持做准备

### 4. 简洁高效（Simplicity）
- **精选的技术栈**：不追求"大而全"，而是选择最合适的工具
- **MVP的意义**：有限的功能集合让我们能深度优化用户体验
- **避免过度设计**：只为当前需求设计，为未来预留扩展空间

---

## 系统架构设计

### 整体架构

```
┌──────────────────────────────────┐
│    Gradio Web 前端               │
│  - 对话界面                       │
│  - 计划管理UI                     │
│  - 复盘提示界面                   │
│  - 用户画像查看                   │
└───────────────┬──────────────────┘
                │
┌───────────────▼──────────────────┐
│  后端服务层 (Services)            │
│  - 事件服务                       │
│  - 计划服务                       │
│  - 复盘服务                       │
│  - 用户服务                       │
│  - LLM配置管理                    │
└───────────────┬──────────────────┘
                │
┌───────────────▼──────────────────┐
│  LangGraph Agent 工作流           │
│  ├─ 事件提取Agent                 │
│  ├─ 用户画像Agent                 │
│  ├─ 计划推动Agent                 │
│  └─ 复盘生成Agent                 │
└───────────────┬──────────────────┘
                │
┌───────────────▼──────────────────┐
│  数据层                           │
│  ├─ SQLite数据库                  │
│  ├─ 文件存储                      │
│  └─ 外部LLM API                   │
└──────────────────────────────────┘
```

### 4个核心Agent

#### 1. 事件提取Agent（Event Extraction Agent）
**职责**：从用户对话中识别和提取生活事件

**工作流**：
```
用户对话 → 事件识别 → 事件分类 → 事件存储
```

**主要功能**：
- 自然语言理解和事件识别
- 事件分类（work, learning, life, health, personal）
- 提取事件的时间、地点、参与者等关键信息
- 与现有事件的去重和合并

**LLM提示词关键点**：
- 要求LLM以JSON格式返回事件
- 明确定义事件分类类别
- 指导LLM忽略闲聊信息，只提取有意义的事件

#### 2. 用户画像Agent（User Portrait Agent）
**职责**：逐步学习用户的特征，积累用户档案

**工作流**：
```
用户交互 → 特征识别 → 特征存储 → 置信度更新
```

**主要功能**：
- 从初始问卷中提取基础信息
- 从对话中分析用户的工作方式（主动/被动、细致/粗放等）
- 从事件中识别用户的关注点和价值观
- 从复盘内容中理解用户的反思能力和改进方向
- 维护特征库，包括置信度

**特征库包括**：
- 目标和价值观
- 行动力风格（主动性、执行力）
- 思维方式（细致度、前瞻性）
- 学习风格（偏好的获取方式）
- 薄弱点和成长领域

#### 3. 计划推动Agent（Plan Motivation Agent）
**职责**：基于用户画像，提供个性化的计划推动和督促

**工作流**：
```
计划数据 → 进度分析 → 用户画像匹配 → 个性化建议
```

**主要功能**：
- 分析计划的当前进度
- 识别潜在的拖延或偏差
- 基于用户画像调整督促方式
- 提供可行的下一步建议

**根据用户画像调整**：
- **行动力强的用户**：挑战性的目标，激发竞争心
- **行动力弱的用户**：分解为小步骤，强化正反馈
- **完美主义用户**：强调过程而非结果
- **务实型用户**：强调实用价值和ROI

#### 4. 复盘生成Agent（Review Generation Agent）
**职责**：生成4层递进式的复盘提示，引导用户深度反思

**工作流**：
```
用户选择复盘 → 获取当日数据 → 生成4层提示 → 用户填写 → 学习反馈
```

**主要功能**：
- 第一层：生成基础反思框架（固定）
- 第二层：基于当日事件生成针对性问题
- 第三层：基于计划进度生成反思问题
- 第四层：基于用户画像生成个性化建议

**4层递进逻辑**：
1. **基础框架**（通用）：固定问题，引导用户思考今天做了什么
2. **事件维度**（动态）：根据当日记录的事件，深化反思
3. **目标维度**（动态）：从计划进度角度引导反思
4. **个性化维度**（智能）：根据用户画像和历史反思，提供针对性建议

---

## 技术栈选择

### 前端：Gradio
**选择理由**：
- 快速开发：无需JavaScript和CSS知识
- 自动响应式：生成现代化的Web UI
- 易于部署：单个Python文件即可运行
- 与Python后端无缝集成

**功能覆盖**：
- Chatbot组件（对话界面）
- Textbox组件（事件输入、计划创建）
- Dataframe组件（事件列表、计划列表）
- 多Tab布局（生活记录、计划、复盘等）
- 自定义主题

### 后端：LangGraph
**选择理由**：
- 专为AI Agent工作流设计
- 清晰的工作流定义（比LangChain更易读）
- 支持复杂的Agent交互和状态管理
- 与Anthropic Claude API原生集成

**使用场景**：
- 事件提取工作流
- 用户画像学习工作流
- 计划推动工作流
- 复盘生成工作流

### LLM：灵活多提供商

**主选方案：Claude Haiku 4.5**
- 成本低（约100倍便宜于GPT-4）
- 性能足够（事件提取、分类、文本理解）
- 快速（完全够用于MVP）
- Anthropic的系统提示更强大（可指导Agent行为）

**备选方案：**
| 提供商 | 模型 | 优势 | 成本 | 场景 |
|------|------|------|------|------|
| OpenAI | GPT-4o mini | 强大，易用 | 中等 | 更复杂的任务 |
| DeepSeek | DeepSeek Pro | 国内友好，便宜 | 低 | 国内部署 |
| Ollama | Llama 2 | 本地运行，隐私 | 0 | 隐私优先 |

**灵活切换实现**：
```python
# src/llm/config.py
LLM_PROVIDER = os.getenv('LLM_PROVIDER', 'claude')  # 环境变量配置
LLM_CONFIG = {
    'claude': {...},
    'openai': {...},
    'deepseek': {...},
    'ollama': {...}
}
```

**好处**：
- 不受政策限制（支持国内外）
- 成本优化空间
- 支持隐私优先选项
- 业务逻辑与LLM选择完全解耦

### 数据库：SQLite（MVP）→ PostgreSQL（生产）

**MVP：SQLite**
- 零配置：无需安装数据库服务
- 文件形式：易于备份和迁移
- 足够性能：MVP规模内完全够用
- 易于测试：可用内存数据库

**升级路径：PostgreSQL**
- 当数据量增大时升级
- SQLAlchemy ORM简化迁移
- 完整的多用户支持
- 更好的并发性能

**数据持久化**：
- SQLite文件位置：`data/mindflow.db`
- 自动备份：定期备份到 `data/backups/`

### ORM：SQLAlchemy
**选择理由**：
- Python ORM标准
- 支持多数据库（SQLite、PostgreSQL等）
- 清晰的模型定义
- 强大的查询接口

### 任务调度：APScheduler
**用途**：
- 定期的计划推动提醒（如每天上午9:00）
- 每日复盘提醒（如每天晚上8:00）
- 数据备份定时任务

### 部署：Docker + Linux

**容器化优势**：
- 确保开发、测试、生产环境一致
- 简化部署流程
- 便于扩展

**目标部署**：
- 自建Linux服务器（如阿里云、DigitalOcean等）
- Docker运行
- Nginx反向代理
- HTTPS/TLS加密

---

## 核心功能设计

### 1. 生活记录系统

**核心流程**：
```
用户对话
  ↓ (事件提取Agent)
事件识别和分类
  ↓ (用户画像Agent)
更新用户特征库
  ↓
数据库存储
```

**用户交互**：
1. 用户在对话框输入今天的事件（自然语言）
2. 系统实时显示识别到的事件
3. 用户可以编辑、删除或补充事件
4. 系统自动分类和标签化事件

**事件分类**：
- **work**：工作相关（项目、会议、学习等）
- **learning**：学习和自我提升
- **life**：日常生活（饮食、运动、娱乐等）
- **health**：健康和身体（睡眠、锻炼、医疗等）
- **personal**：个人成长和反思

**事件属性**：
```json
{
  "event_id": "uuid",
  "title": "完成了项目A的代码审查",
  "category": "work",
  "description": "详细描述",
  "timestamp": "2024-12-03T14:30:00",
  "tags": ["项目A", "代码审查"],
  "related_plans": ["plan_id_1", "plan_id_2"],
  "created_at": "2024-12-03T15:00:00"
}
```

### 2. 计划管理系统

**核心流程**：
```
用户创建计划
  ↓
系统跟踪进度
  ↓ (计划推动Agent)
基于用户画像生成推动建议
  ↓
用户更新计划
```

**计划生命周期**：
1. **创建**：用户设定目标、截止日期、优先级
2. **跟踪**：用户定期更新进度（百分比或任务）
3. **推动**：系统定期推动和提醒
4. **完成/存档**：计划完成或放弃时存档

**计划属性**：
```json
{
  "plan_id": "uuid",
  "title": "完成项目A的v1.0发布",
  "description": "包括功能开发、测试、部署",
  "status": "active",  // active, completed, archived
  "priority": "high",  // high, medium, low
  "progress": 60,  // 0-100百分比
  "start_date": "2024-12-01",
  "due_date": "2024-12-31",
  "milestones": [
    {"name": "功能开发", "completion_date": "2024-12-15", "completed": true},
    {"name": "测试", "completion_date": "2024-12-25", "completed": false}
  ],
  "related_events": ["event_id_1", "event_id_2"],
  "created_at": "2024-12-01"
}
```

**计划进度跟踪**：
- 百分比进度表示
- 里程碑标记
- 与生活事件的关联分析
- 偏差预警（如进度明显落后）

**个性化推动**：
基于用户画像，调整推动方式：
- **强行动力**：增加挑战性目标的激励
- **弱行动力**：分解为小步骤，增加反馈频率
- **完美主义**：强调过程而非结果
- **务实型**：强调ROI和实用价值

### 3. 每日复盘系统

**核心流程**：
```
用户选择复盘
  ↓
生成4层递进式提示
  ↓
用户填写反思内容
  ↓ (用户画像Agent)
学习用户的反思特征，更新用户画像
  ↓
复盘内容存储
```

**4层递进式提示**：

**第一层：基础框架（固定，通用）**
这些问题帮助用户从基础维度反思今天：
- 今天做了哪些事情？
- 今天学到了什么？
- 今天的情绪状态如何？
- 明天有什么计划？

**第二层：事件维度（动态，基于当日事件）**
根据用户当日记录的具体事件，深化反思：
- 在 [事件1] 中，你认为表现最好的地方是什么？
- [事件2] 对你有什么启发？
- 你在 [事件3] 中学到了什么？

**第三层：目标维度（动态，基于计划进度）**
从用户的计划和目标出发：
- 今天在 [计划1] 上的进展是？
- [计划2] 有什么障碍吗？
- 这些进展与你的长期目标的关系是？

**第四层：个性化维度（智能，基于用户画像）**
根据用户的特征和历史反思模式：
- 基于你 [用户特征]，今天的表现体现了什么？
- 相比 [用户的历史模式]，有什么变化？
- 基于你的 [弱点]，明天可以这样改进...

**复盘内容结构**：
```json
{
  "review_id": "uuid",
  "date": "2024-12-03",
  "layer1_response": {
    "events": "记录了5个工作事件和2个生活事件",
    "learning": "学到了新的代码模式",
    "emotion": "今天状态不错，完成了重要任务",
    "tomorrow_plans": "继续项目开发，健身"
  },
  "layer2_response": {
    "event_insights": ["事件1的思考", "事件2的思考", ...]
  },
  "layer3_response": {
    "plan_progress": ["计划1的进展", "计划2的进展", ...]
  },
  "layer4_response": {
    "personalized_insights": "基于用户画像的个性化建议"
  },
  "created_at": "2024-12-03T20:30:00"
}
```

### 4. 用户画像系统

**工作机制**：
系统通过三个环节逐步了解用户：

**第一环：初始问卷（快速获取基础信息）**
用户首次使用时填写：
```
1. 你的主要目标是什么？
2. 你最看重的价值观是什么？
3. 你的工作方向是什么？
4. 你认为自己的性格特点是什么？
5. 你最想改进的地方是什么？
6. 你偏好的督促方式是什么？
7. 你通常什么时候最有精力？
8. 你更喜欢大目标还是小目标？
9. 你的学习风格是什么？
10. 你面临的主要挑战是什么？
11. 还有什么我们应该了解的关于你？
```

**第二环：对话学习（理解工作和思维方式）**
从用户每天记录的事件中分析：
- 用户主要关注的领域（哪类事件更多？）
- 用户的行动方式（主动vs被动？）
- 用户的思维深度（细致vs宏观？）
- 用户的价值偏向（从选择的事件类型看）

**第三环：复盘学习（理解反思能力和成长方向）**
从用户的复盘回答中学习：
- 用户的自我认知（能否准确评价自己？）
- 用户的反思能力（问题有多深？）
- 用户的改进意愿（提到的改进有多具体？）
- 用户的学习风格（从复盘内容看偏好如何学习）

**用户特征库**：
```json
{
  "user_id": "user_uuid",
  "basic_profile": {
    "goals": ["长期目标1", "长期目标2"],
    "values": ["价值观1", "价值观2"],
    "personality_traits": ["特征1", "特征2"],
    "weak_points": ["弱点1", "弱点2"],
    "preferred_reminder_style": "激励型/分解型/务实型"
  },
  "behavior_features": {
    "action_style": {
      "value": "proactive",  // proactive/reactive
      "confidence": 0.85,
      "evidence": ["事件1", "事件2"]
    },
    "thinking_depth": {
      "value": "detailed",  // detailed/macro
      "confidence": 0.72,
      "evidence": ["从复盘回答看"]
    },
    "learning_style": {
      "value": "hands-on",  // hands-on/theoretical/mixed
      "confidence": 0.68,
      "evidence": ["从记录的事件看"]
    },
    // ... 更多特征
  },
  "updated_at": "2024-12-03T15:00:00"
}
```

**个性化应用**：
- 复盘提示会根据用户的特征动态调整措辞和问题难度
- 计划推动会采用用户偏好的方式（激励型vs分解型）
- 系统的建议会体现对用户弱点和成长方向的理解

---

## 数据库设计

### 核心表结构

#### 1. user_profile（用户档案表）
存储用户的基本信息和初始问卷回答

```sql
CREATE TABLE user_profile (
    id TEXT PRIMARY KEY,
    user_id TEXT,  -- 预留多用户支持
    name TEXT,
    goals TEXT,  -- JSON: 长期目标列表
    values TEXT,  -- JSON: 用户价值观
    work_direction TEXT,
    personality_traits TEXT,  -- JSON: 性格特点
    weak_points TEXT,  -- JSON: 需要改进的地方
    preferred_reminder_style TEXT,  -- 激励型/分解型/务实型
    timezone TEXT,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

#### 2. user_behavior_features（用户行为特征库）
存储系统学习到的用户特征

```sql
CREATE TABLE user_behavior_features (
    id TEXT PRIMARY KEY,
    user_id TEXT,
    feature_key TEXT,  -- action_style/thinking_depth/learning_style等
    feature_value TEXT,  -- JSON: {value: "...", confidence: 0.85, ...}
    confidence FLOAT,  -- 置信度 0-1
    last_updated TIMESTAMP
);
```

#### 3. events（生活事件表）
存储用户记录的所有生活事件

```sql
CREATE TABLE events (
    id TEXT PRIMARY KEY,
    user_id TEXT,
    title TEXT,
    category TEXT,  -- work/learning/life/health/personal
    description TEXT,
    timestamp TIMESTAMP,  -- 事件发生的时间
    tags TEXT,  -- JSON: 标签列表
    related_plans TEXT,  -- JSON: 关联的计划ID
    source TEXT,  -- 数据来源（对话/手动输入）
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES user_profile(user_id)
);
```

#### 4. plans（计划表）
存储用户的目标和计划

```sql
CREATE TABLE plans (
    id TEXT PRIMARY KEY,
    user_id TEXT,
    title TEXT,
    description TEXT,
    status TEXT,  -- active/completed/archived
    priority TEXT,  -- high/medium/low
    progress INTEGER,  -- 0-100
    start_date DATE,
    due_date DATE,
    milestones TEXT,  -- JSON: 里程碑列表
    related_events TEXT,  -- JSON: 关联的事件ID
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES user_profile(user_id)
);
```

#### 5. plan_updates（计划更新历史）
追踪计划进度的变化

```sql
CREATE TABLE plan_updates (
    id TEXT PRIMARY KEY,
    plan_id TEXT,
    progress_before INTEGER,
    progress_after INTEGER,
    update_note TEXT,
    updated_at TIMESTAMP,
    FOREIGN KEY (plan_id) REFERENCES plans(id)
);
```

#### 6. reviews（每日复盘记录）
存储用户的复盘内容

```sql
CREATE TABLE reviews (
    id TEXT PRIMARY KEY,
    user_id TEXT,
    review_date DATE,
    layer1_response TEXT,  -- JSON: 基础框架回答
    layer2_response TEXT,  -- JSON: 事件维度回答
    layer3_response TEXT,  -- JSON: 目标维度回答
    layer4_response TEXT,  -- JSON: 个性化维度回答
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES user_profile(user_id)
);
```

#### 7. conversation_history（对话历史）
保留对话上下文用于理解和学习

```sql
CREATE TABLE conversation_history (
    id TEXT PRIMARY KEY,
    user_id TEXT,
    session_id TEXT,
    message_type TEXT,  -- user/assistant
    content TEXT,
    related_events TEXT,  -- JSON: 该消息提取的事件
    timestamp TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES user_profile(user_id)
);
```

### 数据关系图

```
user_profile
    ├── user_behavior_features (一对多)
    ├── events (一对多)
    ├── plans (一对多)
    │    └── plan_updates (一对多)
    ├── reviews (一对多)
    └── conversation_history (一对多)
```

### 多用户支持预留

虽然MVP是单用户，但数据库设计已为多用户做好准备：
- 所有表都有 `user_id` 字段
- 用户隔离通过 `user_id` 实现
- 升级到多用户时，只需添加身份认证层，数据库逻辑无需大改

---

## 用户体验设计

### 1. 初始化流程

**用户首次进入系统**：
1. 欢迎页面，简介系统
2. 填写11个初始化问卷
3. 系统初始化用户档案
4. 跳转到主界面

**初始化问卷**（已在上方数据库设计中列出）

### 2. 日常使用流程

**典型用户日常交互**：

**早晨**（可选）：
- 查看今天的计划和提醒
- 收到系统的动力提示

**全天**：
- 在有事件时，通过对话记录："今天早上完成了项目A的代码审查"
- 系统实时识别事件，用户可以确认或修改

**晚间**：
- 用户选择"开始复盘"
- 系统生成4层提示，用户逐层回答
- 系统学习用户的反思特征，更新用户画像
- 用户查看今天的事件总结

**计划更新**（需要时）：
- 用户手动更新计划进度
- 或系统自动关联事件到计划
- 系统基于进度和用户画像生成推动建议

### 3. Gradio 界面设计

**主界面Tabs**：
```
1. 生活记录 Tab
   - 对话框（输入事件）
   - 事件列表（显示今日事件）
   - 事件编辑和删除功能

2. 计划管理 Tab
   - 计划列表（表格显示）
   - 创建新计划按钮
   - 编辑计划和更新进度
   - 计划进度可视化

3. 每日复盘 Tab
   - 复盘按钮
   - 4层提示显示和回答框
   - 历史复盘查看

4. 用户画像 Tab
   - 当前用户画像展示
   - 初始问卷回顾
   - 学习到的特征展示

5. 系统设置 Tab
   - LLM提供商切换
   - API密钥配置
   - 数据导出和备份
```

**交互特点**：
- 尽可能简洁，避免选项过多
- 实时反馈（用户输入后立即显示识别的事件）
- 移动端友好（Gradio自动响应式）

---

## 9阶段规划

项目整体规划分为9个阶段，涵盖从产品调研到用户隔离架构的完整过程：

### 第一阶段：产品调研和技术方案确认

**时间**：1周
**目标**：确认产品方向和技术可行性

**主要工作**：
- [ ] 产品理念验证
- [ ] 用户访谈（收集真实需求）
- [ ] 竞品分析
- [ ] 技术方案选型和对比
- [ ] 成本估算和收益分析

**交付物**：
- 产品规划文档
- 技术方案对比表
- 风险和假设列表

### 第二阶段：详细的系统架构设计

**时间**：1周
**目标**：完成系统设计和架构确认

**主要工作**：
- [ ] 系统架构设计（4个Agent、服务层、数据层）
- [ ] 数据库Schema设计
- [ ] API接口设计
- [ ] LangGraph工作流设计
- [ ] Gradio界面设计（线框图）

**交付物**：
- 系统架构图
- 完整的数据库Schema SQL
- API接口文档
- LangGraph工作流设计
- UI设计线框图

### 第三阶段：详细的初始化问卷和用户特征设计

**时间**：1周
**目标**：完成用户画像系统的细节设计

**主要工作**：
- [ ] 初始化问卷的11个问题确认
- [ ] 用户特征库的字段定义
- [ ] 特征学习算法设计
- [ ] 用户画像可视化设计

**交付物**：
- 最终的初始化问卷
- 用户特征库完整定义
- 特征学习规则文档
- 用户画像展示设计

### 第四阶段：各功能模块的提示词设计

**时间**：1周
**目标**：完成4个Agent的提示词模板

**主要工作**：
- [ ] 事件提取Agent的提示词（JSON格式、分类规则）
- [ ] 用户画像Agent的提示词（特征识别规则）
- [ ] 计划推动Agent的提示词（个性化推动方式）
- [ ] 复盘生成Agent的提示词（4层提示生成规则）
- [ ] 提示词的迭代测试和优化

**交付物**：
- 4个Agent的最终提示词
- 提示词测试报告
- 预期输出示例

### 第五阶段：MVP开发（Phase 1-6）

**时间**：9-10周
**目标**：完成MVP的所有核心功能

**详见下方的"6个开发Phase"部分**

### 第六阶段：初始化问卷的UI设计和实现

**时间**：在Phase 2中实现
**目标**：确保用户首次体验流畅

**主要工作**：
- [ ] 初始化问卷的Gradio组件设计
- [ ] 问卷数据验证规则
- [ ] 问卷存储和检索
- [ ] 数据安全性保证

### 第七阶段：复盘提示系统的优化

**时间**：在Phase 4中迭代
**目标**：确保4层提示的质量和个性化效果

**主要工作**：
- [ ] 4层提示的生成规则优化
- [ ] 基于初期用户反馈的微调
- [ ] 提示词的持续改进
- [ ] 个性化效果的验证

### 第八阶段：完整的开发检查清单和质量保证

**时间**：Phase 5-6中进行
**目标**：确保代码质量和功能完整性

**主要工作**：
- [ ] 单元测试覆盖核心模块
- [ ] 集成测试验证工作流
- [ ] 用户接受测试
- [ ] 性能测试和优化
- [ ] 安全性审计
- [ ] 代码审查和清理

**检查清单项**：
- 代码可读性和注释
- 错误处理和日志
- 数据验证
- 并发处理
- 数据备份机制
- 文档完整性

### 第九阶段：用户隔离架构设计和预留

**时间**：未来（v2.0规划）
**目标**：为多用户支持做好架构准备

**主要工作**：
- [ ] 用户身份认证系统设计（JWT/Session）
- [ ] 用户隔离的实现方式
- [ ] 权限管理系统
- [ ] 多用户数据迁移方案

**预留设计**：
- 数据库已有 `user_id` 字段
- API已预留 `user_id` 参数
- 服务层已考虑用户上下文
- 可在不重构核心逻辑的前提下扩展

**未来功能**（v2.0+）：
- 用户注册和登录
- 邀请机制
- 用户数据隔离验证
- 多租户架构优化

---

## 6个开发Phase

### Phase 1：基础框架搭建（1-2周）

**目标**：建立项目的技术基础，包括Web框架、数据库、LLM配置层和容器化部署。

**主要任务**：

#### 项目结构初始化
```
mindflow/
├── src/
│   ├── ui/
│   │   └── main.py              # Gradio应用入口
│   ├── llm/
│   │   ├── provider.py          # 抽象基类
│   │   ├── claude.py            # Claude API
│   │   ├── openai.py            # OpenAI API
│   │   └── config.py            # LLM配置管理
│   ├── database/
│   │   ├── connection.py        # 数据库连接
│   │   ├── models.py            # SQLAlchemy ORM模型
│   │   ├── init_db.py           # 初始化脚本
│   │   └── schemas.py           # Pydantic数据模型
│   ├── agents/                  # LangGraph agents（Phase 2+）
│   ├── services/                # 业务逻辑服务层（Phase 2+）
│   └── config.py                # 全局配置
├── tests/
├── Dockerfile
├── docker-compose.yml
├── requirements.txt
├── .env.example
└── README.md
```

**具体任务清单**：
- [ ] 初始化 Git 仓库和项目结构
- [ ] 创建 requirements.txt（Python依赖）
- [ ] 创建 .env.example 文件
- [ ] 创建基础的 Gradio 应用框架
- [ ] 实现 LLM 配置层（支持切换）
- [ ] 定义所有数据库 ORM 模型
- [ ] 创建数据库初始化脚本
- [ ] 创建 Dockerfile
- [ ] 编写 README 和快速开始指南

**交付验证**：
- [ ] ✅ 项目可以启动
- [ ] ✅ Gradio Web应用可在浏览器访问（http://localhost:7860）
- [ ] ✅ 数据库可以初始化
- [ ] ✅ LLM配置可以切换并调用成功
- [ ] ✅ Docker镜像可以构建和运行

**交付物**：
- 可运行的Gradio应用骨架
- 完整的数据库和ORM框架
- 灵活的LLM配置层
- Docker容器化配置

---

### Phase 2：生活记录系统（2周）

**目标**：实现通过对话记录生活事件的核心功能，建立初步的用户画像系统。

**主要任务**：

#### 对话界面开发
- [ ] 创建对话UI组件（Gradio Chatbot）
- [ ] 实现消息发送和接收
- [ ] 实现对话历史管理
- [ ] 实现对话内容持久化

#### 事件提取和存储
- [ ] 创建 `src/agents/event_agent.py`
- [ ] 使用 LangGraph 定义事件提取工作流
- [ ] 实现事件识别和分类逻辑
- [ ] 创建 `src/services/event_service.py`
- [ ] 实现事件的 CRUD 操作
- [ ] 实现事件列表UI展示

#### 用户画像初始化
- [ ] 创建初始化问卷的UI界面
- [ ] 实现问卷数据收集和验证
- [ ] 实现问卷数据存储

#### 用户画像更新机制
- [ ] 创建 `src/agents/user_portrait_agent.py`
- [ ] 使用 LangGraph 定义用户特征学习工作流
- [ ] 实现特征识别逻辑
- [ ] 创建 `src/services/user_service.py`
- [ ] 实现特征的存储和更新

#### 事件查看和管理
- [ ] 实现事件列表视图
- [ ] 实现事件详情查看
- [ ] 实现按日期/类别过滤
- [ ] 实现事件编辑和删除

**交付验证**：
- [ ] ✅ 用户首次进入系统可以填写初始问卷
- [ ] ✅ 用户可以通过对话记录生活事件
- [ ] ✅ 事件可以被正确识别和分类
- [ ] ✅ 事件可以在UI上查看、编辑、删除
- [ ] ✅ 用户画像数据在数据库中正确初始化和更新

**交付物**：
- 可用的对话界面和事件提取系统
- 初始化问卷流程
- 用户画像数据结构和更新机制
- 生活记录功能的完整UI

---

### Phase 3：计划管理系统（1.5周）

**目标**：实现计划的创建、跟踪和更新功能。

**主要任务**：

#### 计划管理的CRUD接口
- [ ] 创建 `src/services/plan_service.py`
- [ ] 实现计划创建、读取、更新、删除
- [ ] 实现计划列表查询（按状态、优先级等）

#### 计划UI界面
- [ ] 创建计划列表视图（Dataframe组件）
- [ ] 实现创建计划的表单
- [ ] 实现编辑计划的表单
- [ ] 实现进度百分比编辑
- [ ] 实现里程碑管理

#### 计划与事件的关联
- [ ] 实现事件和计划的关联逻辑
- [ ] 实现计划进度的自动分析
- [ ] 实现计划相关的统计（完成率、拖延分析等）

#### 计划推动Agent初版
- [ ] 创建 `src/agents/plan_motivation_agent.py`
- [ ] 基本的计划分析和建议生成
- [ ] 与用户画像的初步结合

**交付验证**：
- [ ] ✅ 用户可以创建新计划
- [ ] ✅ 用户可以查看和编辑计划
- [ ] ✅ 计划进度可以跟踪
- [ ] ✅ 可以看到计划与事件的关联

**交付物**：
- 完整的计划管理系统
- 计划管理的UI界面
- 计划推动Agent的初版实现

---

### Phase 4：每日复盘系统（1.5周）

**目标**：实现4层递进式的复盘提示和用户反思功能。

**主要任务**：

#### 复盘生成Agent
- [ ] 创建 `src/agents/review_agent.py`
- [ ] 实现第一层（基础框架）提示生成
- [ ] 实现第二层（事件维度）提示生成
- [ ] 实现第三层（目标维度）提示生成
- [ ] 实现第四层（个性化维度）提示生成

#### 复盘UI界面
- [ ] 创建复盘启动按钮
- [ ] 实现4层提示的展示
- [ ] 实现用户回答的输入框
- [ ] 实现复盘内容的保存

#### 历史复盘查看
- [ ] 实现按日期查看历史复盘
- [ ] 实现复盘内容的回顾

#### 用户画像深化学习
- [ ] 从复盘内容中提取用户特征
- [ ] 更新和优化用户画像的准确性
- [ ] 反馈到后续的个性化提示生成

**交付验证**：
- [ ] ✅ 用户可以启动复盘流程
- [ ] ✅ 4层提示可以正确生成
- [ ] ✅ 复盘内容可以被保存
- [ ] ✅ 历史复盘可以被查看
- [ ] ✅ 用户画像可以从复盘内容中学习

**交付物**：
- 完整的4层复盘提示系统
- 复盘管理的UI界面
- 基于复盘的用户特征更新机制

---

### Phase 5：优化和功能完善（1周）

**目标**：优化系统性能、提升用户体验、完善所有功能细节。

**主要任务**：

#### 功能完善
- [ ] 修复Bug和边界情况处理
- [ ] 完善错误提示和用户引导
- [ ] 优化UI布局和交互流程
- [ ] 实现数据导出功能

#### 性能优化
- [ ] 数据库查询优化（添加索引）
- [ ] LLM调用的缓存和优化
- [ ] 前端响应速度优化

#### 用户体验优化
- [ ] 完整的本地化和国际化（如需要）
- [ ] 帮助文档和使用指南
- [ ] 默认配置和快速开始

#### 提示词优化
- [ ] 基于前期反馈优化4个Agent的提示词
- [ ] 测试和验证提示词质量

#### 定时任务实现
- [ ] 实现每日复盘提醒（APScheduler）
- [ ] 实现计划推动提醒

**交付验证**：
- [ ] ✅ 系统运行稳定，无明显Bug
- [ ] ✅ 性能满足MVP需求
- [ ] ✅ 用户体验流畅

---

### Phase 6：部署和测试（1周）

**目标**：确保系统可以在生产环境中稳定运行，完成最终的部署和测试。

**主要任务**：

#### 单元和集成测试
- [ ] 为核心模块编写单元测试
- [ ] 编写集成测试验证工作流
- [ ] 达到 70%+ 的代码覆盖率

#### 用户接受测试（UAT）
- [ ] 邀请测试用户使用系统
- [ ] 收集反馈和建议
- [ ] 修复发现的问题

#### 生产部署准备
- [ ] 配置生产环境变量
- [ ] 配置数据库备份策略
- [ ] 配置日志和监控
- [ ] 创建部署文档

#### 部署到生产
- [ ] 配置服务器（Linux）
- [ ] 配置Nginx反向代理和HTTPS
- [ ] 部署Docker容器
- [ ] 进行灾害恢复测试

#### 文档完善
- [ ] 编写API文档
- [ ] 编写部署指南
- [ ] 编写运维手册
- [ ] 编写用户指南

**交付验证**：
- [ ] ✅ 单元测试覆盖率 ≥ 70%
- [ ] ✅ 集成测试通过
- [ ] ✅ 用户接受测试通过
- [ ] ✅ 系统可以在生产环境稳定运行

**交付物**：
- 完整的测试报告
- 部署文档
- 运维手册
- 生产就绪的系统

---

## 6个Phase的时间线

```
Phase 1（1-2周）: 2024-12-03 ~ 2024-12-16
    基础框架搭建

Phase 2（2周）: 2024-12-17 ~ 2024-12-30
    生活记录系统

Phase 3（1.5周）: 2024-12-31 ~ 2025-01-13
    计划管理系统

Phase 4（1.5周）: 2025-01-14 ~ 2025-01-27
    每日复盘系统

Phase 5（1周）: 2025-01-28 ~ 2025-02-03
    优化和功能完善

Phase 6（1周）: 2025-02-04 ~ 2025-02-10
    部署和测试

总计：9-10周
MVP发布预期日期：2025-02-10
```

---

## 风险和假设

### 风险分析

#### 1. LLM可靠性风险
**描述**：依赖外部LLM API，可能出现服务中断或性能下降

**影响**：系统无法工作，用户体验严重下降

**缓解措施**：
- 支持多个LLM提供商，可快速切换
- 实现本地LLM选项（Ollama）作为备选
- 添加请求重试和超时控制
- 实现LLM调用的缓存机制

#### 2. 用户画像学习的准确性风险
**描述**：系统可能难以准确从交互中提取用户特征

**影响**：个性化效果不理想，系统价值降低

**缓解措施**：
- 通过初始问卷快速获得基础信息
- 设置特征的置信度机制
- 定期向用户展示学到的特征，允许反馈和修正
- 使用多个信号源（对话、事件、复盘）三角验证

#### 3. 开发周期偏差风险
**描述**：9-10周的估算可能不准确

**影响**：项目延期，调整优先级

**缓解措施**：
- 将项目分为6个Phase，每个Phase都可单独评估
- 预留缓冲时间（当前估算已考虑）
- 定期检查进度，及时调整
- 如需要加速，可简化某些Phase的功能

#### 4. 数据隐私和安全风险
**描述**：用户敏感数据的泄露或滥用

**影响**：用户信任丧失，法律风险

**缓解措施**：
- 所有数据本地存储，不经过第三方
- 使用加密存储敏感数据
- 提供数据导出和删除功能
- 清晰的隐私政策
- 定期安全审计

### 假设清单

#### 核心假设
1. **用户愿意填写初始问卷**
   - 假设：用户愿意花5-10分钟填写11个问题
   - 风险：如果用户不愿意，系统无法获得初始的用户特征
   - 缓解：设计简洁的问卷，清楚说明好处

2. **Claude Haiku 4.5的能力足够**
   - 假设：模型足以完成事件提取、分类、特征识别等任务
   - 风险：如果模型不够强大，需要升级到更强的模型
   - 缓解：在Phase 1中进行充分测试

3. **用户会定期使用系统**
   - 假设：用户至少每天使用一次（记录事件和复盘）
   - 风险：如果用户使用频率低，系统学习效果差
   - 缓解：设计吸引人的UI和推送提醒

4. **用户的工作流程相对稳定**
   - 假设：用户的日常事件模式相对规律
   - 风险：对于事件变化剧烈的用户，系统效果可能不佳
   - 缓解：设计灵活的分类和标签系统

### 未来风险

#### 扩展到多用户时的风险
- **数据隔离风险**：确保不同用户的数据完全隔离
- **成本增加**：多用户支持需要更多的服务器资源
- **复杂度增加**：认证、授权、多租户支持的复杂度

#### 当数据量增加时的风险
- **性能下降**：SQLite在大数据量时性能下降
- **缓解**：实现定期数据归档和迁移到PostgreSQL的机制

---

## 总结

**Mindflow** 是一个设计精良的个人AI助理系统，核心优势是能够逐步了解用户，提供个性化帮助。

**关键成功因素**：
1. **清晰的MVP范围**：只做生活记录 + 计划 + 复盘，形成闭环
2. **灵活的架构**：为未来扩展预留空间，同时避免过度设计
3. **深度个性化**：三层学习机制逐步优化系统的理解
4. **隐私优先**：本地存储，用户数据完全可控
5. **简洁高效**：精选的技术栈，快速开发和部署

**项目时间线**：
- **第1-4周**：基础框架和生活记录系统
- **第5-7周**：计划和复盘系统
- **第8-10周**：优化、测试和部署
- **预期发布**：2025年2月中旬

**后续规划**（v2.0+）：
- 知识库管理和向量检索
- 多用户支持
- 外部应用集成
- 高级分析推荐

这份规划足以指导团队开发出一个有价值的产品，同时足够灵活，能够根据实践进行迭代和优化。

---

**文档版本**: v1.0
**最后更新**: 2024-12-03
**维护者**: Mindflow Team
**预计下一个版本**: v1.0.1 (Phase 1 完成后)
