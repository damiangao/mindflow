# Mindflow æŠ€æœ¯è®¾è®¡æ–‡æ¡£ (ç²¾ç®€ç‰ˆ)

> **åŸºäº**: ARCHITECTURE.md v1.0  
> **ç‰ˆæœ¬**: v1.1  
> **æ—¥æœŸ**: 2026-01-18  
> **çŠ¶æ€**: æ ¸å¿ƒæœºåˆ¶å·²ç¡®å®š

---

## ğŸ¯ æœ¬æ–‡æ¡£ç›®çš„

æœ¬æ–‡æ¡£è¡¥å…… ARCHITECTURE.md,ç”¨æµç¨‹å›¾å’Œä¼ªä»£ç è¯´æ˜æ ¸å¿ƒæœºåˆ¶ã€‚

---

## ğŸ“Š æ•°æ®ç»“æ„å¢å¼º

### Skill èŠ‚ç‚¹æ–°å¢å­—æ®µ

```
Skill {
    ... (åŸºç¡€å­—æ®µè§ ARCHITECTURE.md)
    
    # æ–°å¢: è§„åˆ’ç›¸å…³
    preconditions: ["has_csv_file"]      # å‰ç½®æ¡ä»¶
    effects: ["has_dataframe"]           # äº§ç”Ÿæ•ˆæœ
    
    # æ–°å¢: æ–¹æ³•è®ºè¯„åˆ†
    methodology_scores: {
        "meth_simple": 0.9,              # å¯¹å„æ–¹æ³•è®ºçš„ç¬¦åˆåº¦ 0-1
        "meth_stdlib": 0.7
    }
}
```

### Methodology èŠ‚ç‚¹æ–°å¢å­—æ®µ

```
Methodology {
    ... (åŸºç¡€å­—æ®µè§ ARCHITECTURE.md)
    
    # æ–°å¢: è¯„ä¼°è§„åˆ™
    evaluation_rule: "æ£€æŸ¥æ˜¯å¦ä½¿ç”¨æ ‡å‡†åº“"  # æ–‡æœ¬æè¿°æˆ–ä»£ç 
    weight: 0.8                           # å…¨å±€æƒé‡ 0-1
}
```

## ğŸ”— Skills è°ƒç”¨æ–¹å¼ (æ··åˆæ¨¡å¼)

### æ•°æ®ç»“æ„

```
Skill {
    name: "æ•°æ®æ¸…æ´—æµç¨‹"
    instructions: """
    1. è¯»å–CSVæ–‡ä»¶
    2. éªŒè¯æ•°æ®å®Œæ•´æ€§
    3. å¤„ç†ç¼ºå¤±å€¼
    4. è¾“å‡ºæ¸…æ´—åçš„æ•°æ®
    """
    called_skills: ["CSVå¤„ç†", "æ•°æ®éªŒè¯"]  # å£°æ˜ä¾èµ–
}
```

### æ‰§è¡Œæµç¨‹

```
æ¿€æ´» Skill
    â†“
LLM è¯»å– instructions
    â†“
é€æ­¥æ‰§è¡Œ:
  â”œâ”€ è¯†åˆ«éœ€è¦è°ƒç”¨çš„å­ Skill
  â”œâ”€ ä» called_skills ä¸­æŸ¥æ‰¾
  â”œâ”€ è°ƒç”¨å¹¶ä¼ é€’æ•°æ®
  â””â”€ ç»§ç»­ä¸‹ä¸€æ­¥
    â†“
å®Œæˆ
```

### å…³é”®è®¾è®¡

**called_skills çš„ä½œç”¨**:
- å£°æ˜ä¾èµ–(ç”¨äºè§„åˆ’)
- é™åˆ¶è°ƒç”¨èŒƒå›´(å®‰å…¨æ€§)
- å»ºç«‹å›¾ç»“æ„å…³è”

**LLM çš„èŒè´£**:
- ç†è§£ instructions
- å†³å®šè°ƒç”¨æ—¶æœº
- å¤„ç†æ•°æ®ä¼ é€’

**å®ç°ä¼ªä»£ç **:
```python
def execute_skill(skill, context):
    prompt = f"""
    Skill: {skill.name}
    æ­¥éª¤: {skill.instructions}
    å¯ç”¨å­Skills: {skill.called_skills}
    å½“å‰çŠ¶æ€: {context}
    """
    return llm.execute_with_tools(prompt, tools=skill.called_skills)
```


---

## ğŸ” æ–¹æ³•è®ºè¯„åˆ†æœºåˆ¶

### æµç¨‹å›¾

```
ç”¨æˆ·è¯·æ±‚
    â†“
å‘é‡æœç´¢ â†’ å€™é€‰ Skills [A, B, C]
    â†“
å¯¹æ¯ä¸ª Skill:
    â”œâ”€ è·å– methodology_scores
    â”œâ”€ åŠ æƒæ±‚å’Œ: Î£(æ–¹æ³•è®ºæƒé‡ Ã— ç¬¦åˆåº¦)
    â”œâ”€ å½’ä¸€åŒ–: æ€»å’Œ / æ€»æƒé‡
    â””â”€ æ··åˆå†å²æˆåŠŸç‡: 0.7Ã—è¯„åˆ† + 0.3Ã—success_rate
    â†“
æ’åº â†’ é€‰æ‹©å¾—åˆ†æœ€é«˜çš„ Skill
```

### ä¼ªä»£ç 

```python
def calculate_skill_score(skill, methodologies):
    weighted_sum = 0
    total_weight = 0
    
    for meth in methodologies:
        score = skill.methodology_scores.get(meth.id, 0.5)
        weighted_sum += meth.weight * score
        total_weight += meth.weight
    
    base_score = weighted_sum / total_weight
    
    # æ··åˆå†å²è¡¨ç°
    if skill.usage_count > 0:
        final = 0.7 * base_score + 0.3 * skill.success_rate
    else:
        final = base_score
    
    return clamp(final, 0, 1)
```

---

## ğŸ”„ Skills ç»„åˆæœºåˆ¶ (è§„åˆ’å¼)

### æµç¨‹å›¾

```
ç”¨æˆ·: "å¤„ç†CSVå¹¶ç”Ÿæˆå›¾è¡¨"
    â†“
LLM è§£æç›®æ ‡ â†’ ["has_dataframe", "has_chart"]
    â†“
å½“å‰çŠ¶æ€: {"has_csv_file"}
    â†“
å¯¹æ¯ä¸ªç›®æ ‡çŠ¶æ€:
    â”œâ”€ æ‰¾èƒ½äº§ç”Ÿè¯¥çŠ¶æ€çš„ Skills
    â”œâ”€ æŒ‰æ–¹æ³•è®ºè¯„åˆ†æ’åº
    â”œâ”€ é€‰æ‹©æœ€ä½³ Skill
    â”œâ”€ é€’å½’å¤„ç†å‰ç½®æ¡ä»¶
    â””â”€ æ·»åŠ åˆ°æ‰§è¡Œè®¡åˆ’
    â†“
è¿”å›: [Skill("CSVå¤„ç†"), Skill("æ•°æ®å¯è§†åŒ–")]
```

### ä¼ªä»£ç 

```python
def plan_skills(user_goal, available_skills, current_state):
    # 1. LLM è§£æç›®æ ‡
    required_effects = llm.parse(user_goal)
    # ä¾‹: ["has_dataframe", "has_chart"]
    
    # 2. è´ªå¿ƒæœç´¢
    plan = []
    state = current_state.copy()
    
    for target in required_effects:
        if target in state:
            continue
        
        # æ‰¾å€™é€‰ Skills
        candidates = [s for s in available_skills if target in s.effects]
        
        # è¯„åˆ†æ’åº
        best = max(candidates, key=lambda s: score(s))
        
        # é€’å½’å¤„ç†å‰ç½®æ¡ä»¶
        for precond in best.preconditions:
            if precond not in state:
                sub_plan = plan_skills(precond, available_skills, state)
                plan.extend(sub_plan)
        
        plan.append(best)
        state.update(best.effects)
    
    return plan
```

---

## ğŸ­ ç”¨æˆ·äº¤äº’ä¸‰çº§ç­–ç•¥

### å†³ç­–æµç¨‹

```
æ“ä½œå‘ç”Ÿ
    â†“
è¯„ä¼°é£é™© (0-1)
    â†“
    â”œâ”€ < 0.3: é™é»˜æ‰§è¡Œ (ä¸æ‰“æ–­)
    â”œâ”€ 0.3-0.8: åŠ å…¥é˜Ÿåˆ— (ä»»åŠ¡å®Œæˆæ—¶å±•ç¤º)
    â””â”€ > 0.8: ç«‹å³ç¡®è®¤ (å¼¹çª—)
```

### é£é™©è¯„ä¼°è§„åˆ™

```
æ“ä½œç±»å‹          åŸºç¡€é£é™©    å½±å“èŒƒå›´è°ƒæ•´
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
artifact_add      0.1        local: Ã—1, global: Ã—1.5
skill_update      0.5        local: Ã—1, global: Ã—1.5
skill_create      0.6        local: Ã—1, global: Ã—1.5
methodology_change 0.9       local: Ã—1, global: Ã—1.5
```

### é˜Ÿåˆ—å¤„ç†

```
ä»»åŠ¡å®Œæˆæ—¶:
    â†“
æ£€æŸ¥é˜Ÿåˆ—
    â”œâ”€ é«˜é£é™© (>0.7): å¿…é¡»ç¡®è®¤
    â””â”€ ä½é£é™© (â‰¤0.7): å¯é€‰ç¡®è®¤,1å°æ—¶åè‡ªåŠ¨æ‰¹å‡†
```

---

## ğŸ” å…³è”æœºåˆ¶æŠ€æœ¯å®ç°

### å‘é‡æœç´¢

```
å¯åŠ¨æ—¶:
    â”œâ”€ åŠ è½½æ‰€æœ‰ Skills çš„ name + description
    â”œâ”€ å‘é‡åŒ– (sentence-transformers)
    â””â”€ å»ºç«‹ç´¢å¼• (Chroma)

æŸ¥è¯¢æ—¶:
    â”œâ”€ å‘é‡åŒ–ç”¨æˆ·è¾“å…¥
    â”œâ”€ æœç´¢ Top-K ç›¸ä¼¼ Skills
    â””â”€ æŒ‰éœ€åŠ è½½å®Œæ•´å†…å®¹
```

**æŠ€æœ¯æ ˆ**: Chroma + sentence-transformers (all-MiniLM-L6-v2)

### ä¸Šä¸‹æ–‡åŠ æƒ

```
ç»´æŠ¤ä¸Šä¸‹æ–‡:
    â”œâ”€ recent_topics: æœ€è¿‘10ä¸ªå…³é”®è¯
    â””â”€ current_project: å½“å‰é¡¹ç›®

æŸ¥è¯¢æ—¶:
    â”œâ”€ å‘é‡æœç´¢ â†’ å€™é€‰ Skills
    â”œâ”€ æ£€æŸ¥ä¸ä¸Šä¸‹æ–‡çš„åŒ¹é…åº¦
    â””â”€ è°ƒæ•´å¾—åˆ†: base_score + context_boost (æœ€å¤š+0.5)
```

---

## ğŸ“ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒä¾èµ–

```
å›¾æ•°æ®åº“:
  - Neo4j (ç”Ÿäº§)
  - NetworkX (å¼€å‘/æµ‹è¯•)

å‘é‡æœç´¢:
  - chromadb
  - sentence-transformers

LLM:
  - anthropic / openai
```

### æ€§èƒ½æŒ‡æ ‡

```
å‘é‡ç´¢å¼•:
  - 500 Skills â†’ ç´¢å¼•å¤§å° < 10MB
  - å¯åŠ¨æ—¶é—´ < 2s

å›¾æŸ¥è¯¢:
  - å•è·³æŸ¥è¯¢ < 50ms
  - å¤šè·³æŸ¥è¯¢ < 200ms
```


## ğŸ” æŸ¥è¯¢æµç¨‹è®¾è®¡ (æ¸è¿›å¼)

### Phase 1: æœ€ç®€æ–¹æ¡ˆ (MVP)

```
ç”¨æˆ·è¾“å…¥
    â†“
å‘é‡æœç´¢ â†’ Top-5 Skills
    â†“
æ–¹æ³•è®ºè¯„åˆ† â†’ æ’åº
    â†“
å†³ç­–:
  â”œâ”€ å¾—åˆ†å·®è· > 0.3: è¿”å›æœ€ä½³
  â””â”€ å¾—åˆ†å·®è· < 0.3: è¿”å› Top-3 ä¾›é€‰æ‹©
```

**æ ¸å¿ƒå‡è®¾**: å›¾ç»“æ„çš„é‚»è¿‘å…³ç³»ä¼šè‡ªç„¶ä½“ç°åœ¨å‘é‡ç›¸ä¼¼åº¦ä¸­

**éªŒè¯æŒ‡æ ‡**:
- é¦–æ¬¡å‘½ä¸­ç‡ > 80%
- ç”¨æˆ·éœ€è¦é€‰æ‹©çš„é¢‘ç‡ < 20%

### Phase 2: åé¦ˆä¼˜åŒ– (æŒ‰éœ€)

```
ç”¨æˆ·åé¦ˆ "ä¸æ˜¯è¿™ä¸ª"
    â†“
å›¾ç»“æ„æŸ¥è¯¢:
  â”œâ”€ æ‰¾ sibling skills (åŒæ–¹æ³•è®ºä¸‹)
  â”œâ”€ æ‰¾ related skills (è°ƒç”¨å…³ç³»)
  â””â”€ æ‰¾ upstream/downstream (å‰åç½®)
    â†“
è¿”å›æ–°å€™é€‰
```

**è§¦å‘æ¡ä»¶**:
- ç”¨æˆ·æ˜ç¡®æ‹’ç»
- é¦–æ¬¡æœç´¢å¾—åˆ† < 0.5

**å®ç°ç­–ç•¥**: å…ˆå®ç° Phase 1,æ ¹æ®å®é™…æ•ˆæœå†³å®šæ˜¯å¦éœ€è¦ Phase 2

---

## âœ… æ ¸å¿ƒå†³ç­–æ€»ç»“

1. **Skills ç»„åˆ**: è§„åˆ’å¼ (HTN Planning ç®€åŒ–ç‰ˆ)
2. **æ–¹æ³•è®ºé‡åŒ–**: è¯„åˆ†æœºåˆ¶ + å½’ä¸€åŒ–
3. **ç”¨æˆ·äº¤äº’**: ä¸‰çº§ç­–ç•¥ (é™é»˜/é˜Ÿåˆ—/ç«‹å³)
4. **å‘é‡æœç´¢**: Chroma + sentence-transformers
5. **å›¾æ•°æ®åº“**: Neo4j(ç”Ÿäº§) / NetworkX(å¼€å‘)

---

**ç‰ˆæœ¬**: v1.1  
**æœ€åæ›´æ–°**: 2026-01-18  
**çŠ¶æ€**: æ ¸å¿ƒæœºåˆ¶å·²ç¡®å®š,å¾…å®ç°


---

## ğŸŒ± å†·å¯åŠ¨ç§å­åº“è®¾è®¡

### ç²¾ç®€æ–¹æ¡ˆ (MVP)

**æ–¹æ³•è®ºå±‚**: 5ä¸ª
1. ç®€å•ä¼˜äºå¤æ‚
2. ä¼˜å…ˆä½¿ç”¨æ ‡å‡†åº“/æˆç†Ÿå·¥å…·
3. ä¿æŒä¸€è‡´æ€§
4. ä»å°å¼€å§‹,é€æ­¥è¿­ä»£
5. è®°å½•å’Œå¤ç›˜

**Skills å±‚**: 15-20ä¸ª

```
ç”Ÿæ´»ç®¡ç† (6ä¸ª):
â”œâ”€ ä»»åŠ¡åˆ†è§£
â”œâ”€ ä»»åŠ¡è·Ÿè¸ª
â”œâ”€ æ—¥ç¨‹è§„åˆ’
â”œâ”€ ç¬”è®°æ•´ç†
â”œâ”€ æ—¥å¤ç›˜
â””â”€ å‘¨å¤ç›˜

æ•°æ®å¤„ç† (6ä¸ª):
â”œâ”€ CSV å¤„ç†
â”œâ”€ JSON å¤„ç†
â”œâ”€ æ•°æ®æ¸…æ´—
â”œâ”€ æ•°æ®éªŒè¯
â”œâ”€ æ•°æ®è½¬æ¢
â””â”€ æ•°æ®å¯è§†åŒ–

ä»£ç è¾…åŠ© (3ä¸ª):
â”œâ”€ Python è„šæœ¬ç”Ÿæˆ
â”œâ”€ å‡½æ•°é‡æ„
â””â”€ é”™è¯¯å¤„ç†

é€šç”¨å·¥å…· (2ä¸ª):
â”œâ”€ æ–‡ä»¶è¯»å†™
â””â”€ å‘½ä»¤è¡Œè°ƒç”¨
```

**å‰¯äº§å“å±‚**: æ¯ä¸ª Skill 1ä¸ªæ ¸å¿ƒå‰¯äº§å“

### ç”Ÿæˆæ–¹å¼

- ç”Ÿæ´»ç®¡ç†ç±»: æ‰‹å·¥ç¼–å†™(æ ¸å¿ƒä»·å€¼)
- å…¶ä»–ç±»: LLM ç”Ÿæˆ + äººå·¥å®¡æ ¸
- åç»­: ä» Claude Skills åº“å‚è€ƒä¼˜åŒ–

### å®æ–½é¡ºåº

**Phase 1 (Week 3)**: 5ä¸ªåŸºç¡€ Skills
- ä»»åŠ¡åˆ†è§£, CSVå¤„ç†, Pythonè„šæœ¬ç”Ÿæˆ, æ–‡ä»¶è¯»å†™, æ—¥å¤ç›˜

**Phase 2 (Week 4)**: æ‰©å±•åˆ° 15-20ä¸ª

**åç»­**: ä»ä½¿ç”¨ä¸­å­¦ä¹ ,è‡ªåŠ¨ç”Ÿæˆæ–° Skills
